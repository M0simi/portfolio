{% extends "custom_admin/base.html" %}
{% block content %}
  <h2>إدارة المستخدمين</h2>
  {% include "custom_admin/_messages.html" %}

  <form method="get" class="grid grid-3" style="margin:12px 0;">
    <input name="q" value="{{ q }}" placeholder="بحث بالاسم/البريد" />
    <select name="role">
      <option value="">كل الأدوار</option>
      <option value="admin" {% if role == 'admin' %}selected{% endif %}>Admin</option>
      <option value="student" {% if role == 'student' %}selected{% endif %}>Student</option>
    </select>
    <select name="staff">
      <option value="">الكل</option>
      <option value="true" {% if staff == 'true' %}selected{% endif %}>Staff فقط</option>
      <option value="false" {% if staff == 'false' %}selected{% endif %}>غير Staff</option>
    </select>
    <div style="display:flex; gap:8px; justify-content:flex-end; grid-column: 1 / -1;">
      <a class="secondary" href="{% url 'custom_admin:users_list' %}">مسح</a>
      <button type="submit">بحث</button>
    </div>
  </form>

  <p class="muted">الإجمالي: {{ count }}</p>

  <div class="grid" style="gap:12px;">
    {% for u in page_obj.object_list %}
      <article class="card" style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
        <div>
          <strong>{{ u.email }}</strong> • {{ u.name|default:"—" }}
          <div class="muted" style="font-size:.9rem">
            دور: {{ u.role }} • Staff: {{ u.is_staff }} • نشط: {{ u.is_active }} • أنشئ: {{ u.created_at }}
          </div>
        </div>
        <nav style="display:flex; gap:8px;">
          <a class="secondary" href="{% url 'custom_admin:user_edit' u.pk %}">تعديل</a>
        </nav>
      </article>
    {% empty %}
      <div class="card"><em class="muted">لا يوجد مستخدمون.</em></div>
    {% endfor %}
  </div>

  {% include "custom_admin/_pagination.html" with page_obj=page_obj q=q %}
{% endblock %}
